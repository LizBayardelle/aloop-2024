<header class="container text-center py-5">
  <h1 class="display-3 fw-bold mb-3">Customer Images</h1>
  <p class="lead text-muted mb-3">See real builds from hundreds of our happy customers</p>
  <% photo_count = Photo.where(approved: true).count %>
  <div class="mb-4">
    <span class="badge bg-blue fs-5 px-4 py-2"><%= photo_count %>+ Customer Builds</span>
  </div>
  <button type="button" class="btn btn-red btn-lg px-5 py-3" data-bs-toggle="modal" data-bs-target="#newPhotoModal">
    <i class="fas fa-camera me-2"></i> Submit Your Photo
  </button>

  <!-- Modal -->
  <div class="modal fade" id="newPhotoModal" tabindex="-1" aria-labelledby="newPhotoModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <%= render partial: "photos/modal_innards", locals: { photo: Photo.new } %>
      </div>
    </div>
  </div>
</header>


<% if current_user && current_user.admin && @unapproved_photos&.any? %>
  <section class="bg-blue py-5">
    <div class="container">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h3 class="text-white mb-0">
          <i class="fas fa-clock me-2"></i> Photos Pending Approval
        </h3>
        <span class="badge bg-red fs-6 px-3 py-2"><%= @unapproved_photos.count %> pending</span>
      </div>
      <div class="row g-4">
        <% @unapproved_photos.each do |photo| %>
          <% if photo.image.present? %>
            <div class="col-xl-3 col-lg-4 col-md-6">
              <div class="photo-card photo-thumbnail"
                   data-bs-toggle="modal"
                   data-bs-target="#photoModal"
                   data-photo-id="<%= photo.id %>"
                   data-photo-url="<%= url_for(photo.image) %>"
                   data-photo-comments="<%= photo.comments %>"
                   data-photo-approved="<%= photo.approved %>"
                   data-approve-url="<%= approve_photo_path(photo) %>"
                   data-delete-url="<%= photo_path(photo) %>">
                <div class="photo-card-inner">
                  <img src="<%= url_for(photo.image) %>" alt="Pending customer photo" loading="lazy">
                  <div class="photo-overlay">
                    <i class="fas fa-search-plus"></i>
                  </div>
                </div>
              </div>
            </div>
          <% end %>
        <% end %>
      </div>
    </div>
  </section>
<% end %>



<section class="container py-5">
   <div class="portfolio-menu mb-5">
      <div class="d-flex flex-wrap justify-content-center gap-3">
        <button id="targetall" class="filter-btn active" data-filter="*">
          <i class="fas fa-th me-2"></i>
          <span>All Bikes</span>
        </button>
        <button id="target-kit1" class="filter-btn" data-filter="kit1">
          <i class="fas fa-motorcycle me-2"></i>
          <span>XR250/XR400</span>
        </button>
        <button id="target-kit2" class="filter-btn" data-filter="kit2">
          <i class="fas fa-motorcycle me-2"></i>
          <span>XR600</span>
        </button>
        <button id="target-kit3" class="filter-btn" data-filter="kit3">
          <i class="fas fa-motorcycle me-2"></i>
          <span>SuperMotard & XR650L</span>
        </button>
      </div>
   </div>

  <div class="row g-4 mb-5">
    <% @approved_photos.each do |photo| %>
      <% if photo.image.present? %>
        <div class="portfolio-item item <%= photo.kit %> col-xl-3 col-lg-4 col-md-6">
          <div class="photo-card photo-thumbnail"
               data-bs-toggle="modal"
               data-bs-target="#photoModal"
               data-photo-id="<%= photo.id %>"
               data-photo-url="<%= url_for(photo.image) %>"
               data-photo-comments="<%= photo.comments %>"
               data-photo-approved="<%= photo.approved %>"
               data-approve-url="<%= approve_photo_path(photo) %>"
               data-delete-url="<%= photo_path(photo) %>">
            <div class="photo-card-inner">
              <img src="<%= url_for(photo.image) %>" alt="Customer <%= photo.kit %> build" loading="lazy">
              <div class="photo-overlay">
                <i class="fas fa-search-plus"></i>
              </div>
            </div>
          </div>
        </div>
      <% end %>
    <% end %>
  </div>

</section>

<!-- Single Reusable Photo Modal -->
<div class="modal fade" id="photoModal" tabindex="-1" aria-labelledby="photoModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header border-0 pb-0">
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body pt-0">
        <div class="text-center mb-3">
          <img id="modalPhotoImage" class="img-fluid rounded" src="" alt="Customer photo" style="max-height: 70vh; object-fit: contain;">
        </div>
        <div id="modalPhotoCommentsWrapper">
          <p id="modalPhotoComments" class="text-muted fst-italic"></p>
        </div>

        <% if current_user && current_user.admin %>
          <div id="modalPhotoActions" class="d-flex gap-2 justify-content-center mt-4 pt-3 border-top">
            <a id="modalApproveBtn" href="#" class="btn btn-success" data-method="post" style="display: none;">
              <i class="fas fa-check me-2"></i>Approve Photo
            </a>
            <form id="modalDeleteForm" method="post" style="display: inline;">
              <input type="hidden" name="_method" value="delete">
              <input type="hidden" name="authenticity_token" value="<%= form_authenticity_token %>">
              <button type="submit" class="btn btn-danger" onclick="return confirm('Are you sure you want to delete this photo?');">
                <i class="fas fa-trash me-2"></i>Delete Photo
              </button>
            </form>
          </div>
        <% end %>

      </div>
    </div>
  </div>
</div>

<style>
  .filter-btn {
    background: white;
    border: 2px solid #dee2e6;
    padding: 12px 24px;
    border-radius: 8px;
    font-weight: 500;
    transition: all 0.3s ease;
    cursor: pointer;
  }

  .filter-btn:hover {
    border-color: #0d6efd;
    background: #f8f9fa;
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
  }

  .filter-btn.active {
    background: #0d6efd;
    color: white;
    border-color: #0d6efd;
  }

  .photo-card {
    cursor: pointer;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    transition: all 0.3s ease;
    background: white;
  }

  .photo-card:hover {
    transform: translateY(-5px) scale(1.02);
    box-shadow: 0 8px 16px rgba(0,0,0,0.2);
  }

  .photo-card-inner {
    position: relative;
    aspect-ratio: 1;
    overflow: hidden;
  }

  .photo-card-inner img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
  }

  .photo-card:hover .photo-card-inner img {
    transform: scale(1.1);
  }

  .photo-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.7);
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .photo-overlay i {
    color: white;
    font-size: 2rem;
  }

  .photo-card:hover .photo-overlay {
    opacity: 1;
  }
</style>

<script defer>
  document.addEventListener('DOMContentLoaded', function() {
    // Filter functionality
    const filterButtons = document.querySelectorAll('.filter-btn');
    filterButtons.forEach(button => {
      button.addEventListener('click', function() {
        filterButtons.forEach(btn => btn.classList.remove('active'));
        this.classList.add('active');

        const filter = this.dataset.filter;
        const items = document.querySelectorAll('.portfolio-item');

        if (filter === '*') {
          items.forEach(item => item.style.display = '');
        } else {
          items.forEach(item => {
            if (item.classList.contains(filter)) {
              item.style.display = '';
            } else {
              item.style.display = 'none';
            }
          });
        }
      });
    });

    // Photo modal population
    const photoThumbnails = document.querySelectorAll('.photo-thumbnail');
    photoThumbnails.forEach(thumbnail => {
      thumbnail.addEventListener('click', function() {
        const photoUrl = this.dataset.photoUrl;
        const comments = this.dataset.photoComments;
        const approved = this.dataset.photoApproved === 'true';
        const approveUrl = this.dataset.approveUrl;
        const deleteUrl = this.dataset.deleteUrl;

        // Update modal content
        document.getElementById('modalPhotoImage').src = photoUrl;
        const commentsEl = document.getElementById('modalPhotoComments');
        if (comments && comments.trim() !== '') {
          commentsEl.textContent = comments;
          commentsEl.classList.remove('text-muted');
        } else {
          commentsEl.textContent = 'No description provided';
          commentsEl.classList.add('text-muted');
        }

        // Update admin actions if they exist
        const approveBtn = document.getElementById('modalApproveBtn');
        const deleteForm = document.getElementById('modalDeleteForm');

        if (approveBtn && deleteForm) {
          if (!approved) {
            approveBtn.href = approveUrl;
            approveBtn.style.display = 'inline-block';
          } else {
            approveBtn.style.display = 'none';
          }
          deleteForm.action = deleteUrl;
        }
      });
    });
  });
</script>









