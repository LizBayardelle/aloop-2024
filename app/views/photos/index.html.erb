<header class="container">

  <div class="w-100 mt-3" style="text-align: right">
    <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#newPhotoModal">
      Submit a Photo
    </button>
  </div>

  <!-- Modal -->
  <div class="modal fade" id="newPhotoModal" tabindex="-1" aria-labelledby="newPhotoModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <%= render partial: "photos/modal_innards", locals: { photo: Photo.new } %>
      </div>
    </div>
  </div>

  <div class="col-lg-12 text-center">
     <h1 class="display-3 thin">Customer Images</h1>
     <h4>See real photos from hundreds of our happy customers...</h4>
  </div>
</header>


<% if current_user && current_user.admin && @unapproved_photos&.any? %>
  <section class="bg-blue py-3">
    <div class="container">
      <h3 class="text-center color-white">Photos to Approve</h3>
       <div class="portfolio-item row">
        <% @unapproved_photos.each do |photo| %>
          <% if photo.image.present? %>
            <div class="item <%= photo.kit %> col-lg-3 col-md-4 col-6 col-sm">
              <div class="photo-thumbnail"
                   data-bs-toggle="modal"
                   data-bs-target="#photoModal"
                   data-photo-id="<%= photo.id %>"
                   data-photo-url="<%= url_for(photo.image) %>"
                   data-photo-comments="<%= photo.comments %>"
                   data-photo-approved="<%= photo.approved %>"
                   data-approve-url="<%= approve_photo_path(photo) %>"
                   data-delete-url="<%= photo_path(photo) %>"
                   style="height: 130px; overflow-y: hidden; cursor: pointer;">
              <img class="w-100" src="<%= url_for(photo.image) %>" alt="" loading="lazy">
              </div>
            </div>
          <% end %>
        <% end %>
      </div>
    </div> <!-- container -->
  </section>
<% end %>



<section class="container">
   <div class="portfolio-menu mt-2 mb-5">
      <ul>
        <li id="targetall" class="target btn btn-outline-dark active" data-filter="*">All</li>
        <li id="target-kit1" class="target btn btn-outline-dark" data-filter="kit1">XR250/XR400</li>
        <li id="target-kit2" class="target btn btn-outline-dark" data-filter="kit2">XR600</li>
        <li id="target-kit3" class="target btn btn-outline-dark" data-filter="kit3">SuperMotard and XR650L</li>
      </ul>
   </div>

  <div class="portfolio-item row mb-5">
    <% @approved_photos.each do |photo| %>
      <% if photo.image.present? %>
        <div class="item <%= photo.kit %> col-lg-3 col-md-4 col-6 col-sm">
          <div class="photo-thumbnail"
               data-bs-toggle="modal"
               data-bs-target="#photoModal"
               data-photo-id="<%= photo.id %>"
               data-photo-url="<%= url_for(photo.image) %>"
               data-photo-comments="<%= photo.comments %>"
               data-photo-approved="<%= photo.approved %>"
               data-approve-url="<%= approve_photo_path(photo) %>"
               data-delete-url="<%= photo_path(photo) %>"
               style="height: 130px; overflow-y: hidden; cursor: pointer;">
          <img class="w-100" src="<%= url_for(photo.image) %>" alt="" loading="lazy">
          </div>
        </div>
      <% end %>
    <% end %>
  </div>

</section>

<!-- Single Reusable Photo Modal -->
<div class="modal fade" id="photoModal" tabindex="-1" aria-labelledby="photoModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-body">
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        <img id="modalPhotoImage" class="w-100" src="" alt="">
        <p id="modalPhotoComments" class="mt-3"></p>

        <% if current_user && current_user.admin %>
          <div id="modalPhotoActions">
            <a id="modalApproveBtn" href="#" class="btn btn-black-outline" data-method="post" style="display: none;">Approve</a>
            <form id="modalDeleteForm" method="post" style="display: inline;">
              <input type="hidden" name="_method" value="delete">
              <input type="hidden" name="authenticity_token" value="<%= form_authenticity_token %>">
              <button type="submit" class="btn btn-black-outline" onclick="return confirm('Are you sure you want to delete that photo?');">Delete</button>
            </form>
          </div>
        <% end %>

      </div> <!-- modal body -->
    </div>  <!-- modal content -->
  </div> <!-- modal dialog -->
</div> <!-- modal -->

<script defer>
  document.addEventListener('DOMContentLoaded', function() {
    // Filter functionality
    const targets = document.querySelectorAll('.target');
    targets.forEach(target => {
      target.addEventListener('click', function() {
        targets.forEach(t => t.classList.remove('active'));
        this.classList.add('active');

        const filter = this.dataset.filter;
        const items = document.querySelectorAll('.portfolio-item .item');

        if (filter === '*') {
          items.forEach(item => item.style.display = '');
        } else {
          items.forEach(item => {
            if (item.classList.contains(filter)) {
              item.style.display = '';
            } else {
              item.style.display = 'none';
            }
          });
        }
      });
    });

    // Photo modal population
    const photoThumbnails = document.querySelectorAll('.photo-thumbnail');
    photoThumbnails.forEach(thumbnail => {
      thumbnail.addEventListener('click', function() {
        const photoUrl = this.dataset.photoUrl;
        const comments = this.dataset.photoComments;
        const approved = this.dataset.photoApproved === 'true';
        const approveUrl = this.dataset.approveUrl;
        const deleteUrl = this.dataset.deleteUrl;

        // Update modal content
        document.getElementById('modalPhotoImage').src = photoUrl;
        document.getElementById('modalPhotoComments').textContent = comments || '';

        // Update admin actions if they exist
        const approveBtn = document.getElementById('modalApproveBtn');
        const deleteForm = document.getElementById('modalDeleteForm');

        if (approveBtn && deleteForm) {
          if (!approved) {
            approveBtn.href = approveUrl;
            approveBtn.style.display = 'inline-block';
          } else {
            approveBtn.style.display = 'none';
          }
          deleteForm.action = deleteUrl;
        }
      });
    });
  });
</script>









